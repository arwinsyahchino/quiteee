<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puzzle Kuis Gambar Edukasi</title>
  <style>
    :root {
      --piece-size: min(22vw, 120px);
    }
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      text-align: center;
      background: #f5f7fa;
      margin: 0;
      padding: 15px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 10px;
      font-size: clamp(1.5rem, 5vw, 2rem);
    }
    p {
      color: #7f8c8d;
      font-size: clamp(0.9rem, 3vw, 1.1rem);
      max-width: 800px;
      margin: 0 auto 15px;
    }
    .game-area {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
    }
    .game-container {
      width: 100%;
      max-width: calc(3 * var(--piece-size) + 30px);
      padding: 15px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    .reference-image {
      width: 150px;
      height: 150px;
      border-radius: 10px;
      border: 3px solid #3498db;
      object-fit: cover;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      align-self: center;
    }
    .stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 15px;
      font-size: clamp(0.9rem, 3vw, 1rem);
    }
    #puzzle {
      display: grid;
      grid-template-columns: repeat(3, var(--piece-size));
      grid-gap: 6px;
      justify-content: center;
      margin: 0 auto;
    }
    .piece {
      width: var(--piece-size);
      height: var(--piece-size);
      background-size: calc(3 * var(--piece-size)) calc(3 * var(--piece-size));
      border: 2px solid #ecf0f1;
      border-radius: 5px;
      cursor: pointer;
      transition: transform 0.1s, box-shadow 0.1s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .piece:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      z-index: 1;
    }
    .piece.dragging {
      opacity: 0.8;
      transform: scale(1.1);
      box-shadow: 0 6px 12px rgba(52, 152, 219, 0.3);
      z-index: 10;
    }
    #info {
      margin: 20px auto 15px;
      font-size: clamp(0.9rem, 3vw, 1rem);
      color: #27ae60;
      display: none;
      background: #e8f5e9;
      padding: 12px;
      border-radius: 8px;
      max-width: 600px;
      line-height: 1.5;
    }
    audio {
      margin: 10px auto;
      width: 100%;
      max-width: 300px;
      border-radius: 25px;
      display: none;
    }
    .buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 18px;
      border: none;
      border-radius: 8px;
      background-color: #3498db;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
      font-size: clamp(0.85rem, 3vw, 1rem);
    }
    button:hover {
      background-color: #2980b9;
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
    }
    #nextButton {
      background-color: #27ae60;
    }
    #nextButton:hover {
      background-color: #219653;
    }
    #restartButton {
      background-color: #e74c3c;
    }
    #restartButton:hover {
      background-color: #c0392b;
    }
    /* Modal warning style */
    #warning-modal, #finish-modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.25);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #warning-modal .modal-content, #finish-modal .modal-content {
      background: white;
      border-radius: 18px;
      padding: 30px 20px 20px 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      max-width: 90vw;
      text-align: center;
      min-width: 280px;
    }
    #warning-modal .modal-content .warning-text {
      font-size: 1.1rem;
      color: #333;
      font-weight: 600;
      margin-bottom: 16px;
    }
    #warning-modal .modal-content button,
    #finish-modal .modal-content button {
      margin-top: 10px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      background: #2563eb;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #warning-modal .modal-content button:hover,
    #finish-modal .modal-content button:hover {
      background: #1e40af;
    }
    #finish-modal .finish-title {
      font-size: 1.2rem;
      color: #2c3e50;
      font-weight: bold;
      margin-bottom: 8px;
    }
    #finish-modal .finish-desc {
      font-size: 1.05rem;
      margin-bottom: 20px;
      color: #2563eb;
    }
    @media (max-width: 768px) {
      .game-area {
        flex-direction: column;
        align-items: center;
      }
      .reference-image {
        width: 120px;
        height: 120px;
        order: -1;
        margin-bottom: 15px;
      }
    }
    @media (max-width: 500px) {
      :root {
        --piece-size: 28vw;
      }
      .game-container {
        padding: 12px;
      }
      .piece {
        border-width: 1px;
      }
      .buttons {
        flex-direction: column;
        align-items: center;
      }
      button {
        width: 100%;
        max-width: 200px;
      }
      .reference-image {
        width: 100px;
        height: 100px;
      }
      #warning-modal .modal-content, #finish-modal .modal-content {
        min-width: 70vw;
        padding: 18px 8px 12px 8px;
      }
    }
  </style>
</head>
<body>
  <!-- MODAL PERINGATAN -->
  <div id="warning-modal">
    <div class="modal-content">
      <div class="warning-text">
        Main Handphone harus dapat izin orang tua yaaa!!!<br>
        Harus menggunakan game hanya 15-30 menit saja untuk menghindari kerusakan atau kelelahan mata.
      </div>
      <button onclick="document.getElementById('warning-modal').style.display='none'">Saya Mengerti</button>
    </div>
  </div>
  <!-- MODAL SELESAI / FINISH -->
  <div id="finish-modal" style="display: none;">
    <div class="modal-content">
      <div class="finish-title">Selamat! ðŸŽ‰</div>
      <div class="finish-desc">Kamu telah menyelesaikan semua soal puzzle edukasi.</div>
      <button onclick="window.location.href='http://localhost/quitee/'">Menuju Halaman</button>
    </div>
  </div>

  <h1>Puzzle Gambar Edukasi</h1>
  <p>Susun gambar hingga utuh untuk mendapatkan informasi!</p>
  
  <div class="game-area">
    <div class="game-container">
      <div class="stats">
        <div id="timer">Waktu: 0 detik</div>
        <div id="moveCounter">Langkah: 0</div>
      </div>
      <div id="puzzle"></div>
      <div id="info"></div>
      <audio id="audio" controls></audio>
      <div class="buttons">
        <button id="restartButton">Mulai Ulang</button>
        <button id="nextButton">Gambar Berikutnya</button>
      </div>
    </div>
    <img id="referenceImage" class="reference-image" alt="Gambar Referensi">
  </div>

  <script>
    // Elemen DOM
    const puzzle = document.getElementById('puzzle');
    const info = document.getElementById('info');
    const audio = document.getElementById('audio');
    const nextButton = document.getElementById('nextButton');
    const restartButton = document.getElementById('restartButton');
    const timerDisplay = document.getElementById('timer');
    const moveCounter = document.getElementById('moveCounter');
    const referenceImage = document.getElementById('referenceImage');
    const finishModal = document.getElementById('finish-modal');
    // Data game
    const imageSources = [
      "image1.jpg",
      "image2.jpg",
      "image3.jpg",
      "image4.jpg",
      "image5.jpg",
      "image6.jpg",
      "image7.jpg",
      "image8.jpg",
      "image9.jpg",
      "image10.jpg",
      "image11.jpg"
    ];
    const imageInfos = [
      "Sikat gigi dua kali sehari itu penting banget, loh! Dilakukan pagi setelah sarapan dan malam sebelum tidur supaya gigi tetap bersih, nggak bau mulut, dan bebas dari kuman penyebab gigi berlubang. Soalnya, saat tidur, mulut jadi kering sehingga bakteri bisa berkembang biak lebih cepat kalau gigi kotor.",
      "Kalau sikat gigi, jangan cuma pakai air aja ya. Gunakan sikat gigi dan pasta gigi yang mengandung flouride supaya kotoran dan plak di gigi bisa hilang, dan gigi kamu tetap kuat dan sehat.",
      "Waktu menyikat gigi, semua bagian harus disikat, ya! Jangan cuma depan saja. Bagian samping, dalam, dan atas gigi juga harus dibersihkan supaya nggak ada sisa makanan yang menumpuk.",
      "Sikat gigi itu barang pribadi, nggak boleh dipinjamkan ke orang lain. Pakai sikat gigi milik sendiri biar nggak tertular kuman atau penyakit dari orang lain.",
      "Kalau punya gigi berlubang atau sedang sakit gigi, jangan tunggu parah atau cuma minum obat aja. Lebih baik langsung periksa ke dokter gigi supaya tahu penyebabnya dan bisa ditangani dengan tepat, misalnya ditambal sebelum lubangnya makin besar dan menyakitkan.",
      "Sikat gigi memang penting, tapi ada area yang nggak bisa dijangkau sikat. Nah, makanya kamu juga perlu pakai benang gigi untuk membersihkan sela-sela gigi yang sempit.",
      "Lidah juga harus dibersihkan saat menyikat gigi, karena di lidah juga bisa menumpuk bakteri penyebab bau mulut. Jadi jangan lupa, setelah sikat gigi, bersihkan lidah juga, ya!",
      "Kalau bulu sikat gigi udah mekar atau rusak, itu tandanya harus diganti. Ganti sikat gigi tiap 3 bulan sekali ya, supaya tetap bisa membersihkan gigi dengan maksimal.",
      "Habis makan makanan manis atau lengket, jangan langsung tidur atau cuek aja. Segera berkumur atau sikat gigi, karena sisa makanan manis bisa bikin gigi cepat berlubang.",
      "Meskipun gigi nggak sakit, kamu tetap harus periksa ke dokter gigi setiap 6 bulan sekali. Dokter bisa bantu cek dan bersihin gigi kamu supaya tetap sehat dan bebas dari masalah.",
      "Pegang sikat gigi kamu, lalu arahkan bulu sikatnya ke bagian antara gigi dan gusi. Miringin dikit ya, kayak lagi mau nyapu pinggir lantai! Terus, goyang-goyang pelan sikatnya, jangan ditekan keras. Gerakannya pendek-pendek aja, biar kuman yang sembunyi di pinggir gigi bisa keluar semua. Lakukan ke semua bagian gigi, dari depan, samping, sampai belakang. Pelan-pelan aja, yang penting bersih! Menyikat gigi jangan buru-buru. Minimal butuh waktu 2â€“3 menit supaya semua gigi bersih dan gak ada yang terlewat. Kalau terlalu cepat, kuman dan plak bisa masih nempel di gigi."
    ];
    const audioSources = [
      "audio1.mp3",
      "audio2.mp3",
      "audio3.mp3",
      "audio4.mp3",
      "audio5.mp3",
      "audio6.mp3",
      "audio7.mp3",
      "audio8.mp3",
      "audio9.mp3",
      "audio10.mp3",
      "audio11.mp3"
    ];
    const totalImages = imageSources.length;
    let currentImageIndex = 0;
    const correctOrder = [0,1,2,3,4,5,6,7,8];
    let pieces = [...correctOrder];
    let isDragging = false;
    let timer;
    let seconds = 0;
    let moves = 0;
    let resizeTimer;
    // Fungsi untuk mengacak array
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    // Fungsi untuk merender puzzle
    function renderPuzzle() {
      puzzle.innerHTML = '';
      const img = imageSources[currentImageIndex];
      referenceImage.src = img;
      pieces.forEach(index => {
        const piece = document.createElement('div');
        piece.className = 'piece';
        piece.style.backgroundImage = `url('${img}')`;
        piece.style.backgroundPosition = `-${(index % 3) * 100}% -${Math.floor(index / 3) * 100}%`;
        piece.draggable = true;
        piece.dataset.index = index;
        piece.addEventListener('dragstart', dragStart);
        piece.addEventListener('dragover', dragOver);
        piece.addEventListener('drop', drop);
        piece.addEventListener('touchstart', touchStart, { passive: false });
        piece.addEventListener('touchmove', touchMove, { passive: false });
        piece.addEventListener('touchend', touchEnd);
        puzzle.appendChild(piece);
      });
      updateStats();
    }
    // Fungsi untuk pindah ke gambar berikutnya
    function goToNextImage() {
      if (currentImageIndex < totalImages - 1) {
        currentImageIndex++;
        pieces = shuffle([...correctOrder]);
        info.style.display = 'none';
        audio.style.display = 'none';
        nextButton.style.display = 'none';
        startTimer();
        renderPuzzle();
      }
    }
    // Drag and Drop functions
    function dragStart(e) {
      isDragging = true;
      e.target.classList.add('dragging');
      e.dataTransfer.setData('text/plain', e.target.dataset.index);
    }
    function dragOver(e) {
      e.preventDefault();
      if (!isDragging) return;
    }
    function drop(e) {
      e.preventDefault();
      if (!isDragging) return;
      const draggedIndex = parseInt(e.dataTransfer.getData('text/plain'));
      const droppedOn = e.target.closest('.piece');
      if (!droppedOn || droppedOn.classList.contains('dragging')) {
        isDragging = false;
        document.querySelector('.piece.dragging')?.classList.remove('dragging');
        return;
      }
      const droppedIndex = parseInt(droppedOn.dataset.index);
      swapPieces(draggedIndex, droppedIndex);
      document.querySelector('.piece.dragging')?.classList.remove('dragging');
      isDragging = false;
    }
    // Touch event handlers for mobile
    function touchStart(e) {
      e.preventDefault();
      isDragging = true;
      const piece = e.target.closest('.piece');
      piece.classList.add('dragging');
      window.touchDraggedPiece = piece;
      window.touchStartX = e.touches[0].clientX;
      window.touchStartY = e.touches[0].clientY;
    }
    function touchMove(e) {
      if (!isDragging) return;
      e.preventDefault();
    }
    function touchEnd(e) {
      if (!isDragging || !window.touchDraggedPiece) return;
      e.preventDefault();
      const draggedIndex = parseInt(window.touchDraggedPiece.dataset.index);
      const touchEndX = e.changedTouches[0].clientX;
      const touchEndY = e.changedTouches[0].clientY;
      // Hitung elemen di bawah posisi akhir sentuhan
      const elementAtEnd = document.elementFromPoint(touchEndX, touchEndY);
      const droppedOn = elementAtEnd?.closest('.piece');
      if (droppedOn && droppedOn !== window.touchDraggedPiece) {
        const droppedIndex = parseInt(droppedOn.dataset.index);
        swapPieces(draggedIndex, droppedIndex);
      }
      window.touchDraggedPiece.classList.remove('dragging');
      isDragging = false;
      window.touchDraggedPiece = null;
    }
    // Fungsi untuk menukar posisi potongan puzzle
    function swapPieces(index1, index2) {
      const index1Pos = pieces.indexOf(index1);
      const index2Pos = pieces.indexOf(index2);
      if (index1Pos !== -1 && index2Pos !== -1) {
        [pieces[index1Pos], pieces[index2Pos]] = [pieces[index2Pos], pieces[index1Pos]];
        moves++;
        updateStats();
        renderPuzzle();
        checkCorrect();
      }
    }
    // Fungsi untuk memeriksa apakah puzzle sudah benar
    function checkCorrect() {
      const isCorrect = pieces.every((val, idx) => val === correctOrder[idx]);
      if (isCorrect) {
        stopTimer();
        info.innerHTML = imageInfos[currentImageIndex];
        info.style.display = 'block';
        audio.src = audioSources[currentImageIndex];
        audio.style.display = 'block';
        audio.onended = function() {
          goToNextImage();
        };
        audio.play();
        if (currentImageIndex < totalImages - 1) {
          nextButton.style.display = 'inline-block';
        } else {
          nextButton.style.display = 'none';
          setTimeout(showFinishModal, 700); // kasih jeda biar audio selesai dulu
        }
      }
    }
    // Fungsi timer dengan batas waktu 90 detik
    function startTimer() {
      seconds = 0;
      moves = 0;
      updateStats();
      timer = setInterval(() => {
        seconds++;
        updateStats();
        // Jika waktu mencapai 90 detik dan puzzle belum selesai
        if (seconds >= 90) {
          clearInterval(timer);
          alert("Waktu habis! Puzzle akan diacak ulang.");
          pieces = shuffle([...correctOrder]);
          renderPuzzle();
          startTimer(); // Mulai timer baru
        }
      }, 1000);
    }
    function stopTimer() {
      clearInterval(timer);
    }
    function updateStats() {
      timerDisplay.textContent = `Waktu: ${seconds} detik`;
      moveCounter.textContent = `Langkah: ${moves}`;
    }
    // Handler untuk tombol next
    nextButton.addEventListener('click', goToNextImage);
    // Handler untuk tombol restart
    restartButton.addEventListener('click', () => {
      pieces = shuffle([...correctOrder]);
      info.style.display = 'none';
      audio.style.display = 'none';
      nextButton.style.display = 'none';
      startTimer();
      renderPuzzle();
    });
    // Deteksi perubahan ukuran layar
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        renderPuzzle();
      }, 200);
    });
    // Fungsi show modal selesai
    function showFinishModal() {
      finishModal.style.display = 'flex';
    }
    // Inisialisasi game
    pieces = shuffle([...correctOrder]);
    startTimer();
    renderPuzzle();
  </script>
</body>
</html>
